- Micro-services
  - Shared disk: contains /nix directory, shared with Executor and Cache builder
  - Stores: submissions store, requests queue, cache queue
  - Requests handler: get requests from user, put requests metadata in requests queue and submissions store
  - Executor: polls requests queue, sets up environment, puts environment metadata in cache queue, executes request,
    modifies submission in submissions store
  - Cache builder: polls cache queue, builds the environment from environment metadata to be cached in shared volume

- v0.0.1 Activity flow:
  - Client
    - Sends execute request
  - Requests handler
    - Puts request in requests queue
    - Creates a new submission in the submission store
    - Return the submission data
  - Executor
    - Finds the request in the requests queue after polling
    - Creates a docker container from the base image
    - Run the container to build the nix environment (environment stage)
    - Update the submission in the submissions store with the environment build result
    - If environment got built successfully
      - Run the container to execute the build script (if any) (build stage)
        - Update submission in submission store with the build result
      - [If build is successful or None] Run the container to execute the compile script (if any) (compile stage)
        - Update submission in submissions store with the compile result
      - [If build and/or compile are successful or None] Run the container to execute the run script (run stage)
        - Update submission in submissions store with the run result
    - Remove the docker container
  - Client
    - Sends get submission request
  - Request handler
    - Retrieves submission from the submissions store
    - Sends it to the client

- Future iterations activity flow todo
  - Cache everything
  - Process limits/constraints for each stage
  - Smarter caching
  - Rootless Docker containers, more secure Docker options

============================================================

- v0.0.1 Request structure
  {
    files[]: {
      name: string
      content: string
      encoding: string - base64 | utf8 - default utf8
    }
    stdin: string
    args: string[]
  }

- Let stage_output =
  {
    stdout: string
    stderr: string
    output: string
    code: int
    signal: string
  }

- 0.0.1 Submission structure
  {
    id: UUID
    status: string - QUEUED | SETTING_UP_ENVIRONMENT | BUILDING | COMPILING | RUNNING
    environment: stage_output
    build: stage_output
    compile: stage_output
    run: stage_output
  }
